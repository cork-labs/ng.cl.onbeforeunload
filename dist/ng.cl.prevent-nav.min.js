!function(a){"use strict";function b(a,b){var c=a.indexOf(b);return c>=0&&a.splice(c,1),b}function c(a,b){var c=a.defer(),d=b.slice(),e=function(b){a.all([d[b]()]).then(function(){var a=b+1;a<d.length?e(a):c.resolve()},function(){c.reject()})};return e(0),c.promise}var d=a.module("ng.cork.prevent-nav",[]);d.provider("corkPreventNav",[function(){var d={dlgHeader:"Warning:",msgPrefix:" - ",defaultMsg:"All changes not yet saved will be lost."};this.configure=function(b){a.extend(d,b)},this.$get=["$rootScope","$q","$window","$location",function(e,f,g,h){function i(){var a,b;for(p=!1,s.length=0,a=0;a<n.length;a++)b=n[a],b.checkFn()||(p=!0,b.message&&s.push(b.message));return p&&!s.length&&(s=[d.defaultMsg]),p}function j(){for(var a="",b=0;b<s.length;b++)a+=d.msgPrefix+s[b]+"\n";return(d.dlgHeader?d.dlgHeader+"\n\n":"")+a}function k(){g.onbeforeunload=p?j:null}function l(a,b){Object.defineProperty(t,a,{get:b})}var m,n=[],o=null,p=!1,q=!1,r=!1,s=[],t={addInterceptor:function(c,d,f){if(!a.isFunction(c))throw new Error("checkFn should be a function.");var g={checkFn:c,handleFn:d,message:f};return n.push(g),n.length&&null===o&&(o=e.$watch(i,k)),function(){b(n,g),!n.length&&o&&(o(),o=null)}}};return e.$on("$locationChangeStart",function(b){var d=h.path();if(""!==d)if(q)b.preventDefault();else if(p&&m!==d){b.preventDefault();var e=!0,g=n.filter(function(a){return!a.checkFn()}).map(function(b){return e=e&&a.isFunction(b.handleFn),b.handleFn});e&&g.length&&(m=d,q=!0,c(f,g).then(function(){h.path(m),r=!0,q=!1},function(){m=null,q=!1}))}else m&&r&&(h.path(m),r=!1,m=null)}),l("prevented",function(){return p}),l("suspended",function(){return q}),l("messages",function(){return s}),l("dlgHeader",function(){return d.dlgHeader}),l("msgPrefix",function(){return d.msgPrefix}),l("defaultMsg",function(){return d.defaultMsg}),t}]}])}(angular);